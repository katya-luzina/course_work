# course_work

Процесс восстановления стакана заявок реализован на основании следующей последовательности действий:
1)	Определение входных параметров для осуществления расчетов:
  a.	Тиккер инструмента;
  b.	Границы интервала, данные за который будут использоваться для проведения расчетов;
2)	Определение источника данных на основании входных параметров:
  a.	Обыкновенные акции;
  b.	Привилегированные акции;
  c.	Облигации;
3)	Отбор всех заявок в соответствующей таблице (обыкновенные акции, привилегированные акции, облигации) по введенному тиккеру, время которых меньше времени, которое определено как входной параметр;
4)	Построчный анализ всех заявок, которые были отобраны на предыдущем шаге, за исключением рыночных заявок, и их перемещение в специально созданную для этого сущность – очередь заявок:
  a.	Если состояние заявки 1 – выставление, то такая заявка просто перемещается в очередь заявок;
  b.	Если состояние заявки 0 – отмена, то в очереди заявок осуществляется поиск заявки с соответствующим номером и осуществляется ее обновление:
    i.	Объем заявки обнуляется;
    ii.	Изменяется статус заявки с «Ожидание» на «Отмена»;
    iii.	Указывается время отмены заявки;
  c.	Если состояние заявки 2 – исполнение, то в очереди заявок осуществляется поиск заявки с соответствующим номером и обновление: из указанного в ней объема вычитается объем, на который произошла сделка. Далее осуществляется проверка оставшегося в заявке объема и последующее обновление заявки:
    i.	Если оставшийся в заявке объем = 0:
      1.	Изменяется статус заявки с «Ожидание» на «Исполнение»;
      2.	Указывается время исполнения заявки;
    ii.	Если оставшийся в заявке объем > 0:
      1.	Заявка не обновляется;
    iii.	Если оставшийся в заявке объем < 0:
      1.	Изменяется статус заявки с «Ожидание» на «Айсберг»;
      2.	Указывается время обнаружения айсберг-заявки;
5)	Построчный анализ всех отобранных на предыдущем шаге заявок и перемещение их в специально созданную сущность – стакан заявок:
  a.	Если в стакане заявок уже есть такая пара цена-направление, то объем этой пары увеличивается на величину объема заявки;
  b.	Если в стакане заявок еще нет такой пары цена-направление, то в стакан добавляется новая запись с объемом, ценой и направлением заявки;
6)	Удаление всех уровней цен с нулевыми объемами;
7)	Приведение стакана заявок к стандартному виду: объем на стороне покупки, цена, объем на стороне продажи.

Описание полей сущности «Очередь заявок» (wait_list(wait)):
0)	Направление: покупка или продажа;
1)	Время выставления заявки;
2)	Номер заявки;
3)	Цена;
4)	Объем;
5)	Место выставления заявки (измеряется в количестве шагов цены между лучшей ценой и текущей ценой);
6)  Время идентификации заявки-айсберга (заполняется только для заявок, определенных как айсберг-заявки).

Описание полей сущности «Стакан заявок» (glass(level)):
0)	Счетчик;
1)	Объем на стороне покупки;
2)	Цена;
3)  Объем на стороне продажи.

Описание полей сущности "Айсберг" (iceberg(ice)):
0)  Направление: покупка или продажа;
1)  Время выставления заявки;
2)	Номер заявки;
3)  Цена;
4)	Объем;
5)	Место выставления заявки (измеряется в количестве шагов цены между лучшей ценой и текущей ценой);
6)  Время идентификации заявки-айсберга (заполняется только для заявок, определенных как айсберг-заявки).

Описание полей сущности "Метрики"(metrics(met)):
0)  Направление: покупка или продажа;
1)  Время выставления заявки;
2)	Номер заявки;
3)  Лучшая цена покупки;
4)  Лучшая цена продажи;
5)  Мидпоинт;
6)  Бид-аск спред;
7)  Глубина на стороне покупки;
8)  Глубина на стороне продажи.
